/*! backbone.hashmodels 2013-02-27 */
(function($){function initObjects(options){function encoder(unescape_){return unescape_===!0?function(hash){return hash}:"string"==typeof unescape_&&(unescape_=partialDecoder(unescape_.split("")))||"function"==typeof unescape_?function(hash){return unescape_(encodeURIComponent(hash))}:encodeURIComponent}function partialDecoder(chars){var re=RegExp($.map(chars,encodeURIComponent).join("|"),"ig");return function(enc){return enc.replace(re,decodeURIComponent)}}options=$.extend({unescape:!1},options||{}),locationWrapper.encoder=encoder(options.unescape)}var locationWrapper={put:function(hash,win){(win||window).location.hash=this.encoder(hash)},get:function(win){var hash=(win||window).location.hash.replace(/^#/,"");try{return decodeURIComponent(hash)}catch(error){return hash}},encoder:encodeURIComponent},iframeWrapper={id:"__jQuery_history",init:function(){var html='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';return $("body").prepend(html),this},_document:function(){return $("#"+this.id)[0].contentWindow.document},put:function(hash){var doc=this._document();doc.open(),doc.close(),locationWrapper.put(hash,doc)},get:function(){return locationWrapper.get(this._document())}},implementations={};implementations.base={callback:void 0,type:void 0,check:function(){},load:function(){},init:function(callback,options){initObjects(options),self.callback=callback,self._options=options,self._init()},_init:function(){},_options:{}},implementations.timer={_appState:void 0,_init:function(){var current_hash=locationWrapper.get();self._appState=current_hash,self.callback(current_hash),setInterval(self.check,100)},check:function(){var current_hash=locationWrapper.get();current_hash!=self._appState&&(self._appState=current_hash,self.callback(current_hash))},load:function(hash){hash!=self._appState&&(locationWrapper.put(hash),self._appState=hash,self.callback(hash))}},implementations.iframeTimer={_appState:void 0,_init:function(){var current_hash=locationWrapper.get();self._appState=current_hash,iframeWrapper.init().put(current_hash),self.callback(current_hash),setInterval(self.check,100)},check:function(){var iframe_hash=iframeWrapper.get(),location_hash=locationWrapper.get();location_hash!=iframe_hash&&(location_hash==self._appState?(self._appState=iframe_hash,locationWrapper.put(iframe_hash),self.callback(iframe_hash)):(self._appState=location_hash,iframeWrapper.put(location_hash),self.callback(location_hash)))},load:function(hash){hash!=self._appState&&(locationWrapper.put(hash),iframeWrapper.put(hash),self._appState=hash,self.callback(hash))}},implementations.hashchangeEvent={_init:function(){self.callback(locationWrapper.get()),$(window).bind("hashchange",self.check)},check:function(){self.callback(locationWrapper.get())},load:function(hash){locationWrapper.put(hash)}};var self=$.extend({},implementations.base),requiresIframeTimer=!1;self.type=requiresIframeTimer?"iframeTimer":"onhashchange"in window?"hashchangeEvent":"timer",$.extend(self,implementations[self.type]),$.history=self})(jQuery);