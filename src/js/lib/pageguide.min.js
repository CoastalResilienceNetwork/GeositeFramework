/*! pageguide 2014-01-03 */
tl=window.tl||{},tl.pg=tl.pg||{},function(a){tl.pg.default_prefs={auto_show_first:!0,loading_selector:"#loading",track_events_cb:function(){},handle_doc_switch:null,custom_open_button:null,pg_caption:"page guide",tourtitle:"Open Page Guide for help",check_welcome_dismissed:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{if(localStorage.getItem(a))return!0}catch(b){if(document.cookie.indexOf(a)>-1)return!0}return!1},dismiss_welcome:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{localStorage.setItem(a,!0)}catch(b){var c=new Date;c.setDate(c.getDate()+365),document.cookie=a+"=true; expires="+c.toUTCString()}},ready_callback:null},tl.pg.wrapper_markup='<div id="tlyPageGuideWrapper"><div id="tlyPageGuideMessages"><a href="#" class="tlypageguide_close" title="Close Guide">close</a><span class="tlypageguide_index"></span><div class="tlypageguide_text"></div><a href="#" class="tlypageguide_back" title="Previous">Previous</a><a href="#" class="tlypageguide_fwd" title="Next">Next</a></div></div>',tl.pg.toggle_markup='<div class="tlypageguide_toggle" title="Launch Page Guide"><div><span class="tlypageguide_toggletitle"></span></div><a href="#" class="tlypageguide_close" title="close guide">close guide &raquo;</a></div>',tl.pg.init=function(b){if(b=a.extend({},tl.pg.default_prefs,b),clearInterval(tl.pg.interval),0!==a("#tlyPageGuide").length){var c=a("#tlyPageGuide"),d=a(tl.pg.wrapper_markup),e=c.data("tourtitle")||b.tourtitle;null==b.custom_open_button&&a(".tlypageguide_toggle").length<1&&(d.append(tl.pg.toggle_markup),d.find(".tlypageguide_toggle").prepend(b.pg_caption),d.find(".tlypageguide_toggletitle").text(e)),d.prepend(c),a("#tlyPageGuideWrapper").remove(),a("body").append(d);var f=new tl.pg.PageGuide(a("#tlyPageGuideWrapper"),b);return f.ready(function(){f.setup_welcome(),f.setup_handlers(),f.$base.children(".tlypageguide_toggle").animate({right:"-120px"},250),"function"==typeof b.ready_callback&&b.ready_callback()}),f}},tl.pg.PageGuide=function(b,c){this.preferences=c,this.$base=b,this.$all_items=this.$base.find("#tlyPageGuide > li"),this.$items=a([]),this.$message=a("#tlyPageGuideMessages"),this.$fwd=this.$base.find("a.tlypageguide_fwd"),this.$back=this.$base.find("a.tlypageguide_back"),this.$welcome=a("#tlyPageGuideWelcome"),this.cur_idx=0,this.track_event=this.preferences.track_events_cb,this.handle_doc_switch=this.preferences.handle_doc_switch,this.custom_open_button=this.preferences.custom_open_button,this.is_open=!1},tl.pg.hashUrl=function(){var a,b,c=window.location.href,d=0;if(0===c.length)return d;for(a=0;a<c.length;a++)b=c.charCodeAt(a),d=(d<<5)-d+b,d&=d;return d.toString()},tl.pg.isScrolledIntoView=function(b){var c=a(window).scrollTop(),d=c+a(window).height(),e=a(b).offset().top,f=e+a(b).height();return f>=c&&d-100>=e},tl.pg.destroy=function(){a("#tlyPageGuideWrapper").remove(),a("#tlyPageGuideOverlay").remove(),a(".tlypageguide_shadow").removeClass("tlypageguide_shadow"),a("body").removeClass("tlypageguide-open"),a("body").removeClass("tlyPageGuideWelcomeOpen")},tl.pg.PageGuide.prototype.setup_welcome=function(){var b=a("#tlyPageGuideWelcome"),c=this;b.length>0&&(c.preferences.show_welcome=!c.preferences.check_welcome_dismissed(),c.preferences.show_welcome&&(a("#tlyPageGuideOverlay").length||a("body").prepend('<div id="tlyPageGuideOverlay"></div>'),b.appendTo(c.$base)),b.find(".tlypageguide_ignore").length&&b.on("click",".tlypageguide_ignore",function(){c.close_welcome(),c.track_event("PG.ignoreWelcome")}),b.find(".tlypageguide_dismiss").length&&b.on("click",".tlypageguide_dismiss",function(){c.close_welcome(),c.preferences.dismiss_welcome(),c.track_event("PG.dismissWelcome")}),b.on("click",".tlypageguide_start",function(){c.open(),c.track_event("PG.startFromWelcome")}),c.preferences.show_welcome&&c.pop_welcome())},tl.pg.PageGuide.prototype.ready=function(b){var c=this;return tl.pg.interval=window.setInterval(function(){a(c.preferences.loading_selector).is(":visible")||(b(),clearInterval(tl.pg.interval))},250),this},tl.pg.PageGuide.prototype._on_expand=function(){var b=document,c=window;this.position_tour(),this.cur_idx=0;var d=b.createElement("style");b.getElementsByTagName("head")[0].appendChild(d),c.createPopup||(d.appendChild(b.createTextNode("")),d.setAttribute("type","text/css"));var e=b.styleSheets[b.styleSheets.length-1],f="";this.$items.each(function(e){var g=a(a(this).data("tourtarget")+":visible:first");g.addClass("tlypageguide_shadow tlypageguide_shadow"+e);var h=".tlypageguide_shadow"+e+":after { height: "+g.outerHeight()+"px; width: "+g.outerWidth(!1)+"px; }";if(c.createPopup)f+=h;else{var i=b.createTextNode(h,0);d.appendChild(i)}a(this).find(".tlyPageGuideStepIndex").remove(),a(this).html('<div class="tlyPageGuideStepText">'+a(this).text()+"</div>"),a(this).prepend('<ins class="tlyPageGuideStepIndex">'+(e+1)+"</ins>"),a(this).data("idx",e)}),c.createPopup&&(e.cssText=f),this.preferences.auto_show_first&&this.$items.length>0&&this.show_message(0)},tl.pg.PageGuide.prototype.open=function(){this.preferences.show_welcome&&(this.preferences.dismiss_welcome(),this.close_welcome()),this.is_open||(this.is_open=!0,this.track_event("PG.open"),this._on_expand(),this.$items.toggleClass("expanded"),a("body").addClass("tlypageguide-open"))},tl.pg.PageGuide.prototype.close=function(){this.is_open&&(this.is_open=!1,this.track_event("PG.close"),this.$items.toggleClass("expanded"),this.$message.animate({height:"0"},500,function(){a(this).hide()}),a('[class~="tlypageguide_shadow"]').removeClass(function(a,b){return b.match(/tlypageguide_shadow.*?\b/g).join(" ")}),a("ins").remove(),a("body").removeClass("tlypageguide-open"))},tl.pg.PageGuide.prototype.setup_handlers=function(){var b=this,c=null==b.custom_open_button?this.$base.find(".tlypageguide_toggle"):a(b.custom_open_button);c.off(),c.on("click",function(){return b.is_open?b.close():!b.preferences.show_welcome||b.preferences.check_welcome_dismissed()||a("body").hasClass("tlyPageGuideWelcomeOpen")?b.open():b.pop_welcome(),!1}),a(".tlypageguide_close",this.$message.add(a(".tlypageguide_toggle"))).on("click",function(){return b.close(),!1}),this.$all_items.off(),this.$all_items.on("click",function(){var c=a(this).data("idx");b.track_event("PG.specific_elt"),b.show_message(c)}),this.$fwd.on("click",function(){var a=(b.cur_idx+1)%b.$items.length;return b.track_event("PG.fwd"),b.show_message(a),!1}),this.$back.on("click",function(){var a=(b.cur_idx+b.$items.length-1)%b.$items.length;return b.track_event("PG.back"),b.show_message(a,!0),!1}),a(window).resize(function(){b.position_tour()})},tl.pg.PageGuide.prototype.show_message=function(b,c){var d=this.cur_idx,e=this.$items[d],f=this.$items[b];this.cur_idx=b,this.handle_doc_switch&&this.handle_doc_switch(a(f).data("tourtarget"),a(e).data("tourtarget")),a("div",this.$message).html(a(f).children("div").html()),this.$items.removeClass("tlypageguide-active"),a(f).addClass("tlypageguide-active"),tl.pg.isScrolledIntoView(a(f))||a("html,body").animate({scrollTop:a(f).offset().top-50},500);var g=100,h=parseFloat(this.$message.css("height"));this.$message.css("height","auto");var i=parseFloat(this.$message.outerHeight());this.$message.css("height",h+"px"),g>i&&(i=g),i>a(window).height()/2&&(i=a(window).height()/2),i+="px",this.$message.show().animate({height:i},500),this.roll_number(this.$message.find("span"),a(f).children("ins").html(),c)},tl.pg.PageGuide.prototype.roll_number=function(a,b,c){a.animate({"text-indent":(c?"":"-")+"50px"},"fast",function(){a.html(b),a.css({"text-indent":(c?"-":"")+"50px"},"fast").animate({"text-indent":"0"},"fast")})},tl.pg.PageGuide.prototype.position_tour=function(){this.$items=this.$all_items.filter(function(){return a(a(this).data("tourtarget")).is(":visible")}),this.$items.each(function(){var b=a(this),c=a(b.data("tourtarget")).filter(":visible:first"),d=b.data("position"),e=c.offset().left,f=c.offset().top;"fixed"==d&&(f-=a(window).scrollTop()),b.hasClass("tlypageguide_top")?f-=60:f+=b.hasClass("tlypageguide_bottom")?c.outerHeight()+15:5,b.hasClass("tlypageguide_right")?e+=c.outerWidth(!1)+15:b.hasClass("tlypageguide_left")?e-=65:e+=5,b.css({left:e+"px",top:f+"px",position:d})})},tl.pg.PageGuide.prototype.pop_welcome=function(){a("body").addClass("tlyPageGuideWelcomeOpen"),this.track_event("PG.welcomeShown")},tl.pg.PageGuide.prototype.close_welcome=function(){a("body").removeClass("tlyPageGuideWelcomeOpen")}}(jQuery);